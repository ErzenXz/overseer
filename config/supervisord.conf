; ============================================
; Overseer Supervisord Configuration
; For running all services in a single container
; ============================================

[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor
loglevel=info

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

; ============================================
; Web Admin Panel (Next.js)
; ============================================
[program:web]
command=node /app/server.js
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=10
stdout_logfile=/var/log/supervisor/web.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile=/var/log/supervisor/web-error.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3
environment=NODE_ENV="production",PORT="3000"
priority=100

; ============================================
; Telegram Bot
; ============================================
[program:telegram-bot]
command=npx tsx /app/src/bot/index.ts
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=5
; Wait for web to start first
depends_on=web
stdout_logfile=/var/log/supervisor/telegram-bot.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile=/var/log/supervisor/telegram-bot-error.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3
environment=NODE_ENV="production"
priority=200

; ============================================
; Discord Bot (Optional - disabled by default)
; ============================================
[program:discord-bot]
command=npx tsx /app/src/bot/discord.ts
directory=/app
autostart=false
autorestart=true
startretries=3
startsecs=5
depends_on=web
stdout_logfile=/var/log/supervisor/discord-bot.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile=/var/log/supervisor/discord-bot-error.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3
environment=NODE_ENV="production"
priority=201

; ============================================
; Group for all services
; ============================================
[group:overseer]
programs=web,telegram-bot
priority=999
